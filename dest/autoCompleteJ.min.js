/*! AutoCompleteJ 0.1.0
 * Author: Herman Lee <threeday0905@gmail.com>
 * Description: AutoComplete widget, support both html5 / legacy mode
 * Date: 2013-08-20 */
"use strict";!function(a){if(!a||!a.document)throw new Error("This library can only used on browser.");var b=a.document;b.body,a.console;var c=Object.prototype.toString,d=Object.prototype.hasOwnProperty;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=this.length,d=new Array(c),e=0;c>e;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(null===this)throw new TypeError;var c,d=this.length,e=0;if(0===d)return-1;if(b&&(e=Number(b),isNaN(e)?e=0:0!==e&&1/0!==e&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(c=e>=0?e:Math.max(d-Math.abs(e),0);d>c;c++)if(this[c]===a)return c;return-1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){if(null===this)throw new TypeError;if("function"!=typeof a)throw new TypeError;for(var c,d=[],e=0,f=this.length;f>e;e++)e in this&&(c=this[e],a.call(b,c,e,this)&&d.push(c));return d}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError;var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var e={is:{arr:Array.isArray||function(a){return"[object Array]"===c.call(a)},obj:function(a){return"[object Object]"===c.call(a)},fn:function(a){return"[object Function]"===c.call(a)},reg:function(a){return"[object RegExp]"===c.call(a)},date:function(a){return"[object Date]"===c.call(a)},str:function(a){return"[object String]"===c.call(a)},num:function(a){return"[object Number]"===c.call(a)},bool:function(a){return"[object Boolean]"===c.call(a)},undef:function(a){return void 0===a},empty:function(a){if(null===a||void 0===a)return!0;if(e.is.arr(a)||e.is.str(a))return 0===a.length;for(var b in a)if(d(b))return!1;return!0},element:function(a){return!(!a||1!==a.nodeType)}},oo:{inherit:function(){var a=function(){};return function(b,c){a.property=c.prototype,b.property=new a,b.uber=c.prototype,b.prototype.constructor=b}}(),mixin:function(a){var b,c,d,f;if(d=a||{},arguments.legnth<=1)return d;for(var g=1,h=arguments.length;h>g;g++)if(b=arguments[g])if(Object.keys)for(var i=Object.keys(b),j=0,k=i.length;k>j;j++)c=i[j],e.is.obj(b[c])?((e.is.empty(d[c])||!e.is.obj(d[c]))&&(d[c]=e.is.arr(b[c])?[]:{}),e.oo.mixin(d[c],b[c])):(f=Object.getOwnPropertyDescriptor(b,c),e.is.obj(f)?Object.defineProperty(d,c,f):d[c]=f);else for(c in b)b.hasOwnProperty(c)&&(e.is.obj(b[c])?((e.is.empty(d[c])||!e.is.obj(d[c]))&&(d[c]=e.is.arr(b[c])?[]:{}),e.oo.mixin(d[c],b[c])):d[c]=b[c]);return d}},evt:{bind:function(b,c,d){return e.is.element(b)&&c&&e.is.fn(d)?(b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent&&b.attachEvent("on"+c,function(b){var c=this;b=b||a.event,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},d.call(c,b)}),void 0):!1}},css:function(){function a(a,b){return c?function(b,c){c&&b.classList[a](c)}:function(a,c){if(c){var d=a.className.split(/\s+/),e=d.indexOf(c);b(d,e,c),a.className=d.join(" ")}}}var c=void 0!==b.createElement("div").classList;return{add:a("add",function(a,b,c){-1===b&&a.push(c)}),remove:a("remove",function(a,b){b>-1&&a.splice(b,1)}),toggle:a("toggle",function(a,b,c){b>-1?a.splice(b,1):a.push(c)}),contains:function(a,b){return c?a.classList.contains(b):a.className.lastIndexOf(b)>-1}}}(),elem:{appendChild:function(a,b){b.appendChild(a)},insertBefore:function(a,b){var c=b.parentNode;c.insertBefore(a,b)},insertAfter:function(a,b){var c=b.parentNode;c.lastChild===b?c.appendChild(a):c.insertBefore(a,b.nextSibling)}},style:{computed:function(a){return a.currentStyle||b.defaultView.getComputedStyle(a,null)}}},f={nativeSupported:!(!b.createElement("datalist")||!a.HTMLDataListElement),html5:{inputListProp:"list",listTag:"datalist",optionsHtml:'<option value="{value}"/>',replaceToken:"{value}"},legacy:{inputListProp:"list",listTag:"ul",optionsHtml:"<li>{value}</li>",replaceToken:"{value}"}},g={html5:!0,onInit:!1,onMatched:!1,onUnMatched:!1,onKeyUp:!1,ignoreCase:!0,searchAny:!0,maxEntries:1e3,sort:!1,className:{datalist:"autoCompleteJ-datalist",wrapper:"autoCompleteJ-wrapper",active:"autoCompleteJ-active",hover:"autoCompleteJ-active"}},h=function(a,b,c){var d=this,i=h._initMethods,j=i.factory;d.id=i.getInstanceId();var k=e.oo.mixin({},g,c);if(d.options=k,d.input=i.makeInputByIdOrSelf(a),i.validateInput(d.input)&&(d.source=i.makeArrayIfSourceIsEmpty(b),i.validateSource(d.source))){var l=d.options.html5&&f.nativeSupported,m=l?"html5":"legacy";d.engine=j(m,d),d.engineType=m,e.is.fn(k.onInit)&&k.onInit.call(null)}};h.prototype={},h._initMethods={instanceCount:0,getInstanceId:function(){var a=String(++this.instanceCount);return"datalist_"+new Array(3-a.length).join("0")+a},factory:function(a,b){if(!a)throw new Error("Factory method need factoryName");var c;switch(a){case"html5":c=new j(b);break;default:c=new k(b)}return c},makeInputByIdOrSelf:function(a){var c;return e.is.element(a)?c=a:e.is.str(a)&&(c=b.getElementById(a)),c},validateInput:function(a){if(!e.is.element(a))throw new Error("The element is not exists");var b=a.tagName.toLowerCase();if("input"!==b)throw new Error("The element is not an input element");return!0},makeArrayIfSourceIsEmpty:function(a){return(null===a||void 0===a)&&(a=[]),a},validateSource:function(a){if(!e.is.arr(a))throw new Error("Datalist should be array type");for(var b=0,c=a.length;c>b;b++)if(!e.is.str(a[b]))throw new Error("Index #"+b+"in datalist should be string format");return!0}};var i=function(a,b){var c=this;c.options=b,c.element=c.generateContainer(),c.updateSource(a),c.updateContent()};i.prototype={isItemMatchSource:function(a){var b=this;return b.options.ignoreCase?b._lowerCaseSource.indexOf(a.toLowerCase())>-1:b.source.indexOf(a)>-1},sortSource:function(a){var b=this,c=b.options.sort;return c===!0?a.sort():e.is.fn(c)&&a.sort(c),a},updateSource:function(a){var b=this;b.source=a,b.options.ignoreCase&&(b._lowerCaseSource=b.source.map(function(a){return a.toLowerCase()}))},sliceSource:function(a){var b=this;return!b.options.html5engine&&a.length>b.options.maxEntries&&(a=a.slice(0,b.options.maxEntries)),a},filterSource:function(a){var b,c=this;return b=c.options.searchAny?c.options.ignoreCase?c.source.filter(c.getSearchAnyICFn(a)):c.source.filter(c.getSearchAnyFn(a)):c.options.ignoreCase?c.source.filter(c.getSearchStartICFn(a)):c.source.filter(c.getSearchStartFn(a))},getSearchAnyFn:function(a){return function(b){return b.lastIndexOf(a)>-1}},getSearchAnyICFn:function(a){return a=a.toLowerCase(),function(b){return b.toLowerCase().lastIndexOf(a)>-1}},getSearchStartFn:function(a){var b=new RegExp("^"+a);return function(a){return b.test(a)}},getSearchStartICFn:function(a){var b=new RegExp("^"+a,"i");return function(a){return b.test(a)}},updateContent:function(a){var b=this,c=b.source;a&&(c=b.filterSource(a)),c=b.sliceSource(c),c=b.sortSource(c),b.element.innerHTML=b.generateListHtml(c)},generateContainer:function(){var a=this,c=a.options.containerTag,d=b.createElement(c);return d},generateListHtml:function(a){var b=this,c=b.options.listHtmlSample,d=b.options.htmlReplaceToken,e=b.getHTMLParseMethod(c,d),f=a.map(e);return f.join("")},getHTMLParseMethod:function(a,b){var c,d=b.replace(/(\{|\})/g,function(a,b){return"\\"+b}),e=new RegExp(d,"g"),f=a.match(e);if(1===f.length){var g=a.search(e),h=b.length,i=a.substr(0,g),j=a.substr(g+h);c=this.getMethodToConcat(i,j)}else c=this.getMethodToReplace(e,a);return c},getMethodToReplace:function(a,b){return function(c){return b.replace(a,function(){return c})}},getMethodToConcat:function(a,b){return function(c){return a+c+b}}};var j=function(a){var b=this,c=a.input,d=a.source,g=a.options;g=e.oo.mixin(g,{html5engine:!0,containerTag:f.html5.listTag,listHtmlSample:f.html5.optionsHtml,htmlReplaceToken:f.html5.replaceToken});var h=new i(d,g);b.instance=a,b.datalist=h,b.options=g,b.element={input:c,datalist:h.element},b.matched=!1,b.elemInit(),b.elemEventInit(),b.elemRender()};j.prototype={elemInit:function(){var a=this;a.element.datalist.setAttribute("id",a.instance.id),a.element.input.setAttribute(f.html5.inputListProp,a.instance.id)},elemEventInit:function(){var a=this;e.evt.bind(a.element.input,"keyup",a.inputOnKeyUp.bind(a)),e.evt.bind(a.element.input,"focus",a.inputOnFocus.bind(a)),e.evt.bind(a.element.input,"blur",a.inputOnBlur.bind(a))},elemRender:function(){var a=this;e.elem.insertAfter(a.element.datalist,a.element.input)},startLisiting:function(){var a=this;a._lisitingId=setInterval(function(){var b=a.element.input.value;a._lastValue!==b&&(a.datalist.isItemMatchSource(b)?a.matched||a.onMatched():a.matched&&a.unMatched(),a._lastValue=b)},200)},endLisiting:function(){var a=this;a._lisitingId&&clearInterval(a._lisitingId)},onMatched:function(){var a=this;e.is.fn(a.options.onMatched)&&a.options.onMatched.call(a.element.input,a.element.input.value),a.matched=!0},unMatched:function(){var a=this;e.is.fn(a.options.onUnMatched)&&a.options.onUnMatched.call(a.element.input,a.element.input.value),a.matched=!1},inputOnFocus:function(){var a=this;a.startLisiting()},inputOnBlur:function(){var a=this;setTimeout(function(){a.endLisiting()},250)},inputOnKeyUp:function(a){var b=this;e.is.fn(b.options.onKeyUp)&&b.options.onKeyUp.call(b.element.input,a.keyCode,b.element.input.value)}};var k=function(a){var c=this,d=a.input,g=a.source,h=a.options;h=e.oo.mixin(h,{html5engine:!1,containerTag:f.legacy.listTag,listHtmlSample:f.legacy.optionsHtml,htmlReplaceToken:f.legacy.replaceToken});var j=new i(g,h);c.instance=a,c.datalist=j,c.options=h,c.element={input:d,datalist:j.element,wrapper:b.createElement("div")},c.selectedItem=null,c.hoveringItem=null,c.inputHasFocus=!1,c.listShown=!1,c.elemInit(),c.elemEventInit(),c.elemRender()};k.prototype={assignValue:function(a){var b=this;b.element.input.value=a},filterItem:function(a){var b=this;b.datalist.updateContent(a),b.lastSeachText=a},elemInit:function(){var a=this,b=a.element;a.element.datalist.setAttribute("id",a.instance.id),a.element.input.setAttribute("autocomplete","off"),e.css.add(b.datalist,a.options.className.datalist),e.css.add(b.wrapper,a.options.className.wrapper)},elemEventInit:function(){var a=this,b=a.element;e.evt.bind(b.input,"focus",a.inputOnFocus.bind(a)),e.evt.bind(b.input,"blur",a.inputOnBlur.bind(a)),e.evt.bind(b.input,"keyup",a.inputOnKeyUp.bind(a)),e.evt.bind(b.input,"click",a.inputOnClick.bind(a)),e.evt.bind(b.datalist,"click",a.itemOnClick.bind(a))},elemRender:function(){var a=this,b=a.element;e.elem.appendChild(b.datalist,b.wrapper),e.elem.insertBefore(b.wrapper,b.input),e.elem.insertBefore(b.input,b.datalist),"static"!==e.style.computed(b.input).position&&a.fixAbsolutePositionInput()},fixAbsolutePositionInput:function(){var a=this,b=a.element;b.wrapper.style.position=e.style.computed(b.input).position,b.wrapper.style.width=b.input.offsetWidth+"px",b.wrapper.style.left=e.style.computed(b.input).left,b.wrapper.style.top=e.style.computed(b.input).top,b.input.style.position="static"},startLisiting:function(){var a=this;a._lisitingId=setInterval(function(){var b=a.element.input.value;a._lastValue!==b&&(a.datalist.isItemMatchSource(b)?a.matched||a.onMatched():a.matched&&a.unMatched(),a._lastValue=b)},200)},endLisiting:function(){var a=this;a._lisitingId&&clearInterval(a._lisitingId)},onMatched:function(){var a=this;e.is.fn(a.options.onMatched)&&a.options.onMatched.call(a.element.input,a.element.input.value),a.matched=!0},unMatched:function(){var a=this;e.is.fn(a.options.onUnMatched)&&a.options.onUnMatched.call(a.element.input,a.element.input.value),a.matched=!1},listToShow:function(){var a=this,b=a.element;e.css.add(b.datalist,a.options.className.active),b.datalist.scrollTop=0,a.listShown=!0},listToHide:function(){var a=this,b=a.element;a.itemToReset(),e.css.remove(b.datalist,a.options.className.active),a.listShown=!1},adjustListScroll:function(a){var b=20,c=this,d=c.element.datalist,e=a.offsetTop+a.offsetHeight,f=d.scrollTop+b,g=d.scrollTop+d.offsetHeight-b;e>f&&(d.scrollTop+=a.offsetHeight),g>=e&&(d.scrollTop-=a.offsetHeight)},itemToSelect:function(a){var b=this;b.itemToHover(a),b.selectedItem=a,b.assignValue(a.textContent||a.innerText)},itemToHover:function(a){var b=this;b.itemToReset(),e.css.add(a,b.options.className.active),b.hoveringItem=a},itemToReset:function(){var a=this;a.selectedItem&&e.css.remove(a.selectedItem,a.options.className.active),a.selectedItem=void 0,a.hoveringItem&&e.css.remove(a.hoveringItem,a.options.className.active),a.hoveringItem=void 0},firstItem:function(){var a=this;return a.element.datalist.childNodes[0]},inputOnFocus:function(){var a=this;setTimeout(function(){a.inputHasFocus=!0},200),a.startLisiting()},inputOnBlur:function(){var a=this;a.inputHasFocus=!1,a.listShown&&setTimeout(function(){a.listToHide(),a.endLisiting()},250)},inputOnKeyUp:function(a){var b=this,c=a.keyCode;switch(b.listShown||b.listToShow(),c){case 38:b.keyToChoicePrevItem();break;case 40:b.keyToChoiceNextItem();break;case 13:b.keyToSelectItem(),b.listToHide(),a.preventDefault();break;case 9:b.keyToSelectItem(),b.listToHide();break;case 27:b.listToHide();break;default:var d=b.element.input.value;d!==b.lastSeachText&&b.filterItem(d)}e.is.fn(b.options.onKeyUp)&&b.options.onKeyUp.call(b.element.input,a.keyCode,b.element.input.value)},keyToChoicePrevItem:function(){var a=this;a.hoveringItem?a.hoveringItem.previousSibling&&a.itemToHover(a.hoveringItem.previousSibling):a.itemToHover(a.firstItem()),a.adjustListScroll(a.hoveringItem)},keyToChoiceNextItem:function(){var a=this;a.hoveringItem?a.hoveringItem.nextSibling&&a.itemToHover(a.hoveringItem.nextSibling):a.itemToHover(a.firstItem()),a.adjustListScroll(a.hoveringItem)},keyToSelectItem:function(){var a=this;a.hoveringItem&&a.itemToSelect(a.hoveringItem)},inputOnClick:function(){var a=this;a.inputHasFocus&&a.listToShow()},itemOnClick:function(a){var b=this;b.itemToSelect(a.target||a.srcElement)}},"object"==typeof a.module?a.module.exports=h:"function"==typeof a.define?a.define(function(){return h}):a.AutoCompleteJ=h,h.debug=function(){h.tool=e,h.coreFlag=f,h.DataListContainer=i,h.AutoCompleteHTML5=j,h.AutoCompleteLegacy=k}}(window);
/*
//@ sourceMappingURL=dest/autoCompleteJ-source.js
*/